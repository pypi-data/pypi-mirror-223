var S=(e,t,o)=>{if(!t.has(e))throw TypeError("Cannot "+o)};var b=(e,t,o)=>(S(e,t,"read from private field"),o?o.call(e):t.get(e)),$=(e,t,o)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,o)},U=(e,t,o,i)=>(S(e,t,"write to private field"),i?i.call(e,o):t.set(e,o),o);var G=(e,t,o)=>(S(e,t,"access private method"),o);import{i as m,j as oe,k as le,_ as q,o as c,c as u,d as n,F as H,r as X,t as w,u as r,b as d,bF as re,y as R,bG as ie,p as K,h as Q,bH as ce,m as k,aL as de,n as V,bw as ue,w as E,a4 as M,R as j,v as pe,f as g,bx as ge,a as he,T as _e,bI as we,bJ as P}from"./index.e75a6486.js";import{C as T}from"./vue-select.77d34a55.js";function me(e){const t=e==0?0:Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}const z=m(0);async function f(e,t){try{z.value+=1;const o=await fetch(e,t);if(!o.ok)throw new Error(o.status);return await o.json()}finally{z.value-=1}}var h,D,W;class fe{constructor(t,o){$(this,D);$(this,h,void 0);this.interval=t,this.callback=o}start(){b(this,h)&&clearTimeout(b(this,h)),U(this,h,setTimeout(G(this,D,W).bind(this),this.interval))}stop(){clearTimeout(b(this,h)),U(this,h,null)}restart(){this.stop(),this.start()}}h=new WeakMap,D=new WeakSet,W=function(){Promise.resolve(this.callback()).then(()=>{b(this,h)&&this.start()})};const _=oe({});function be(){return _}function ye(e){f(`/api/download/downloads/${encodeURIComponent(e.entry.id)}`,{method:"DELETE"}).then(t=>{_[t.entry.id]=t})}function ve(e){Z(e.entry)}async function Le(e){return await f("/api/download/downloads/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.map(({id:t})=>({id:t})))})}async function Y(){return await f("/api/download/downloads/")}function Z(e){Le([e]).then(t=>{console.log("update"),Object.assign(_,A(t))})}function F(e){return e.id in _&&["pending","downloading","downloaded"].includes(_[e.id].state)&&_[e.id]}async function Ie(){return await f("/api/download/languages/")}async function ke(e){return await f(`/api/download/languages/${encodeURIComponent(e)}`)}async function De(e){return await f(`/api/download/by-language/${encodeURIComponent(e)}`)}let J=new fe(1e3,async()=>{const e=await Y();Object.assign(_,A(e))});le(_,e=>{const t=new Set(["pending","downloading"]);Object.values(e).some(o=>t.has(o.state))?J.restart():J.stop()});function A(e){return Object.fromEntries(e.map(t=>[t.entry.id,t]))}Y().then(e=>{Object.assign(_,A(e))});const Oe=e=>(K("data-v-4cac883f"),e=e(),Q(),e),Ne={class:"downloads-popup"},Ce=Oe(()=>n("summary",null,"Downloads",-1)),Se={class:"corpus-name"},$e={class:"download-state"},Ue=["onClick"],Ve=["onClick"],Me={__name:"DownloadPopup",setup(e){return(t,o)=>(c(),u("details",Ne,[Ce,n("ul",null,[(c(!0),u(H,null,X(r(be)(),i=>(c(),u("li",{key:i.entry.id},[n("span",Se,w(i.entry.corpus),1),n("em",$e,w(i.state),1),["pending","downloading"].includes(i.state)?(c(),u("button",{key:0,onClick:v=>r(ye)(i),title:"Cancel download"},[d(r(re))],8,Ue)):R("",!0),["failed","cancelled"].includes(i.state)?(c(),u("button",{key:1,onClick:v=>r(ve)(i),title:"Retry download"},[d(r(ie))],8,Ve)):R("",!0)]))),128))])]))}},Te=q(Me,[["__scopeId","data-v-4cac883f"]]);const y=e=>(K("data-v-6adabc6e"),e=e(),Q(),e),Ae={class:"downloader"},Be=y(()=>n("h1",{class:"datasets-catalogue-title"},[g(" Datasets catalogue "),n("small",null,[n("em",null,"TODO"),g(" datasets")])],-1)),xe={class:"search-inputs"},Ge={class:"segmented-control"},Re={class:"sort-order"},Ee={class:"dataset-list"},je=["id"],Pe={class:"dataset-name"},ze={class:"dataset-title"},Fe=["href"],Je={key:0,class:"download-dataset-button",disabled:"disabled"},qe={key:1,class:"download-dataset-button",disabled:""},He=["onClick"],Xe={class:"metadata-dataset"},Ke=y(()=>n("dt",null,"Version",-1)),Qe={title:"Version"},We=y(()=>n("dt",null,"Languages",-1)),Ye={title:"Languages"},Ze=y(()=>n("dt",null,"Pairs",-1)),et={title:"Sentence pairs"},tt=y(()=>n("dt",null,"Size",-1)),at={title:"Download size"},st={__name:"AddDatasetView",props:{preprocessing:{type:String,default:"bilingual"},languages:{type:Array,default:()=>[]}},setup(e){const t=e;function o(l){return l!=""}const i={MONOLINGUAL:"monolingual",BILINGUAL:"bilingual"};window.localStorage["add-dataset-preprocessing"]=t.preprocessing,window.localStorage["add-dataset-languages"]=t.languages.join(";");const v=ce(),B=[{label:"Corpus name",compare:(l,s)=>l.corpus.localeCompare(s.corpus)},{label:"Download size",compare:(l,s)=>s.size-l.size},{label:"Sentence pairs",compare:(l,s)=>s.pairs-l.pairs}],O=m(B[0]),N=new Map,C=new Map,L=m(""),I=m(!0),x=m(),ee=k(()=>{if(!t.languages[0])return[];if(!N.has(t.languages[0])){const l=m([]);N.set(t.languages[0],l),ke(t.languages[0]).then(s=>{l.value=s})}return N.get(t.languages[0]).value}),te=k(()=>{const l=new Intl.DisplayNames([],{type:"language",languageDisplay:"standard"});return(x.value||[]).map(s=>{try{return{lang:s,label:`${l.of(s)} (${s})`}}catch{return{lang:s,label:s}}})}),ae=k(()=>{const l=new Intl.DisplayNames([],{type:"language",languageDisplay:"standard"});return(ee.value||[]).map(s=>{try{return{lang:s,label:`${l.of(s)} (${s})`}}catch{return{lang:s,label:s}}})}),se=k(()=>{let l;switch(t.preprocessing){case i.BILINGUAL:if(!t.languages[0]||!t.languages[1])return[];l=`${t.languages[0]}-${t.languages[1]}`;break;case i.MONOLINGUAL:if(!t.languages[0])return[];l=`${t.languages[0]}`;break;default:throw new Error("Unknown preprocessing type")}if(!C.has(l)){const a=m([]);C.set(l,a),De(l).then(p=>a.value=p)}let s=C.get(l).value;return L.value.length>0&&(s=s.filter(({corpus:a,group:p})=>a.toLowerCase().indexOf(L.value.toLowerCase())!==-1)),s=s.filter(a=>{switch(t.preprocessing){case i.BILINGUAL:return a.langs.filter(o).length>1;case i.MONOLINGUAL:return a.langs.filter(o).length==1;default:return!1}}),I.value&&(s=Array.from(s.reduce((a,p)=>((!a.has(p.corpus)||a.get(p.corpus).version<p.version)&&a.set(p.corpus,p),a),new Map).values())),s.sort(O.value.compare),s});de(async()=>{Ie().then(l=>{x.value=l})});const ne=new Intl.NumberFormat;return(l,s)=>(c(),u("div",Ae,[Be,n("div",xe,[n("label",null,[V(n("input",{type:"search",placeholder:"Search dataset\u2026","onUpdate:modelValue":s[0]||(s[0]=a=>L.value=a)},null,512),[[ue,L.value]])]),n("span",Ge,[d(r(j),{class:M({"search-button":!0,checked:e.preprocessing==i.MONOLINGUAL}),to:{name:"add-dataset",params:{preprocessing:i.MONOLINGUAL,languages:t.languages.slice(0,1)}}},{default:E(()=>[g(" Monolingual ")]),_:1},8,["class","to"]),d(r(j),{class:M({"search-button":!0,checked:e.preprocessing==i.BILINGUAL}),to:{name:"add-dataset",params:{preprocessing:i.BILINGUAL,languages:t.languages}}},{default:E(()=>[g(" Bilingual ")]),_:1},8,["class","to"])]),n("label",{class:M(["search-button",{checked:I.value}])},[V(n("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=a=>I.value=a)},null,512),[[pe,I.value]]),g(" Latest only ")],2),n("label",null,[d(r(T),{options:r(te),reduce:({lang:a})=>a,modelValue:t.languages[0],"onUpdate:modelValue":s[2]||(s[2]=a=>r(v).push({name:"add-dataset",params:{preprocessing:t.preprocessing,languages:[a].concat(t.languages.slice(1))}})),placeholder:"Origin language"},null,8,["options","reduce","modelValue"])]),V(n("label",null,[d(r(T),{options:r(ae),reduce:({lang:a})=>a,modelValue:t.languages[1],"onUpdate:modelValue":s[3]||(s[3]=a=>r(v).push({name:"add-dataset",params:{preprocessing:t.preprocessing,languages:[t.languages[0],a]}})),placeholder:"Target language"},null,8,["options","reduce","modelValue"])],512),[[ge,e.preprocessing==i.BILINGUAL]]),n("label",Re,[g(" Sort by: "),d(r(T),{modelValue:O.value,"onUpdate:modelValue":s[4]||(s[4]=a=>O.value=a),options:B,placeholder:"Sort order"},null,8,["modelValue"])])]),n("div",Ee,[(c(!0),u(H,null,X(r(se),a=>(c(),u("div",{class:"dataset",key:a.id,id:`did-${a.id}`},[n("div",Pe,[n("h3",ze,[n("a",{href:`https://opus.nlpl.eu/${a.corpus}-${a.version}.php`,target:"_blank"},w(a.corpus),9,Fe)]),"paths"in a?(c(),u("button",Je,[g(" Downloaded "),d(r(we),{class:"download-icon"})])):r(F)(a)?(c(),u("button",qe,[g(w(r(F)(a).state)+" ",1),d(r(P),{class:"download-icon"})])):(c(),u("button",{key:2,class:"download-dataset-button",onClick:p=>r(Z)(a)},[g(" Download "),d(r(P),{class:"download-icon"})],8,He))]),n("dl",Xe,[Ke,n("dd",Qe,w(a.version),1),We,n("dd",Ye,w(a.langs.filter(o).join("\u2192")),1),Ze,n("dd",et,w(a.pairs?r(ne).format(a.pairs):""),1),tt,n("dd",at,w(a.size?r(me)(a.size):""),1)])],8,je))),128))]),(c(),he(_e,{to:".navbar"},[d(Te)]))]))}},rt=q(st,[["__scopeId","data-v-6adabc6e"]]);export{rt as default};
