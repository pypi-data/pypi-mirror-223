"use strict";(self.webpackChunk_dagster_io_dagit_app=self.webpackChunk_dagster_io_dagit_app||[]).push([[333],{81333:function(n,e,t){t.r(e),t.d(e,{CONCURRENCY_LIMIT_FRAGMENT:function(){return W},ConcurrencyLimits:function(){return G},FREE_CONCURRENCY_SLOTS_FOR_RUN_MUTATION:function(){return nn},INSTANCE_CONCURRENCY_LIMITS_QUERY:function(){return X}});var r,i,o,c,s,l=t(71171),u=t(32723),a=t(34795),d=t(96234),x=t(90239),p=t(15541),f=t(31623),h=t(47515),y=t(62459),m=t(3586),j=t(20356),g=t(83473),C=t(67445),v=t(45519),b=t(22e3),Z=t(92555),w=t(67888),k=t(95714),I=t(73070),_=t(85357),R=t(3077),T=t(80923),N=t(78193),S=t(50032),E=t(82182),K=t(72691),F=t(62638),O=t(39707),z=t(74894),L=t(67099),P=t(20967),$=t(8709),A=t(671),B=t(8589),D=t(35936),Y=N.memo((function(){(0,z.Px)(),(0,L.j)("Concurrency");var n=(0,K.gV)().flagInstanceConcurrencyLimits,e=N.useContext(A.N).pageTitle,t=(0,x.a)(X,{notifyOnNetworkStatusChange:!0}),r=(0,O.C4)(t,O.dT),i=t.data,o=i?n?(0,D.jsx)(G,{instanceConfig:i.instance.info,limits:i.instance.concurrencyLimits,hasSupport:i.instance.supportsConcurrencyLimits,refetch:t.refetch}):(0,D.jsx)(S.l_,{to:"/config"}):(0,D.jsx)(h.x,{padding:{vertical:64},children:(0,D.jsx)(y.$,{purpose:"section"})});return(0,D.jsxs)(m.T,{children:[(0,D.jsx)(j.m,{title:(0,D.jsx)(g.X6,{children:e}),tabs:(0,D.jsx)(B.Z,{tab:"concurrency",refreshState:r})}),o]})}));e.default=Y;var G=function(n){var e=n.instanceConfig,t=n.hasSupport,r=n.limits,i=n.refetch,o=N.useState(),c=(0,d.Z)(o,2),s=c[0],l=c[1],u=N.useState(void 0),a=(0,d.Z)(u,2),x=a[0],p=a[1],f=N.useState(void 0),y=(0,d.Z)(f,2),m=y[0],j=y[1],g=N.useCallback((function(){p(void 0),j(void 0)}),[j,p]),I=Object.fromEntries(r.map((function(n){return[n.concurrencyKey,n.slotCount]}))),_=function(){l({actionType:"add"})},R=function(n){l({actionType:"edit",concurrencyKey:n,concurrencyLimit:I[n]})},T=function(n){l({actionType:"delete",concurrencyKey:n})};return!t&&e&&e.includes("SqliteEventLogStorage")?(0,D.jsx)(h.x,{margin:24,children:(0,D.jsx)(C.t,{icon:"error",title:"No concurrency support",description:"This instance does not support global concurrency limits. You will need to configure a different storage implementation (e.g. Postgres/MySQL) to use this feature."})}):!1===t?(0,D.jsx)(h.x,{margin:24,children:(0,D.jsx)(C.t,{icon:"error",title:"No concurrency support",description:"This instance does not currently support global concurrency limits. You may need to run `dagster instance migrate` to add the necessary tables to your dagster storage to support this feature."})}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(h.x,{children:[(0,D.jsx)(h.x,{flex:{justifyContent:"flex-end"},padding:16,children:(0,D.jsx)(v.zx,{intent:"primary",icon:(0,D.jsx)(b.JO,{name:"add_circle"}),onClick:function(){return _()},children:"Add concurrency limit"})}),0===r.length?(0,D.jsx)(C.t,{icon:"error",title:"No concurrency limits",description:(0,D.jsxs)(D.Fragment,{children:["No concurrency limits have been configured for this instance.\xa0",(0,D.jsx)(Z.Z,{onClick:function(){return _()},children:"Add a concurrency limit"}),"."]})}):(0,D.jsxs)(w.i,{children:[(0,D.jsx)("thead",{children:(0,D.jsxs)("tr",{children:[(0,D.jsx)("th",{style:{width:"260px"},children:"Concurrency key"}),(0,D.jsx)("th",{style:{width:"20%"},children:"Occupied slots"}),(0,D.jsx)("th",{style:{width:"20%"},children:"Total slots"}),(0,D.jsx)("th",{children:"Active runs"}),(0,D.jsx)("th",{})]})}),(0,D.jsx)("tbody",{children:r.map((function(n){return(0,D.jsxs)("tr",{children:[(0,D.jsx)("td",{children:n.concurrencyKey}),(0,D.jsx)("td",{children:n.activeSlotCount}),(0,D.jsx)("td",{children:n.slotCount}),(0,D.jsx)("td",{children:0===n.activeRunIds.length?(0,D.jsx)(D.Fragment,{children:"\u2014"}):(0,D.jsx)(k.V,{intent:"primary",interactive:!0,children:(0,D.jsxs)(Z.Z,{onClick:function(){j(n.concurrencyKey),p(n.activeRunIds)},children:[n.activeRunIds.length," ",1===n.activeRunIds.length?"run":"runs"]})})}),(0,D.jsx)("td",{children:(0,D.jsx)(U,{concurrencyKey:n.concurrencyKey,onEdit:R,onDelete:T})})]},n.concurrencyKey)}))})]})]}),(0,D.jsx)(Q,{open:"add"===(null===s||void 0===s?void 0:s.actionType),onClose:function(){return l(void 0)},onComplete:i}),(0,D.jsx)(J,{concurrencyKey:s&&"delete"===s.actionType?s.concurrencyKey:"",open:"delete"===(null===s||void 0===s?void 0:s.actionType),onClose:function(){return l(void 0)},onComplete:i}),(0,D.jsx)(V,{open:"edit"===(null===s||void 0===s?void 0:s.actionType),onClose:function(){return l(void 0)},onComplete:i,concurrencyKey:"edit"===(null===s||void 0===s?void 0:s.actionType)?s.concurrencyKey:""}),(0,D.jsx)(M,{title:(0,D.jsxs)("span",{children:["Active runs for ",(0,D.jsx)("strong",{children:m})]}),onClose:g,runIds:x})]})},U=function(n){var e=n.concurrencyKey,t=n.onDelete,r=n.onEdit;return(0,D.jsx)(I.J,{content:(0,D.jsxs)(_.v2,{children:[(0,D.jsx)(_.sN,{icon:"edit",text:"Edit",onClick:function(){return r(e)}}),(0,D.jsx)(_.sN,{icon:"delete",intent:"danger",text:"Delete",onClick:function(){return t(e)}})]}),position:"bottom-left",children:(0,D.jsx)(v.zx,{icon:(0,D.jsx)(b.JO,{name:"expand_more"})})})},q=function(n){if(!n)return!1;var e=parseInt(n);return!isNaN(e)&&(String(e)===n.trim()&&(e>0&&e<1e3))},Q=function(n){var e=n.open,t=n.onClose,r=n.onComplete,i=N.useState(!1),o=(0,d.Z)(i,2),c=o[0],s=o[1],l=N.useState(""),x=(0,d.Z)(l,2),f=x[0],y=x[1],m=N.useState(""),j=(0,d.Z)(m,2),g=j[0],C=j[1];N.useEffect((function(){y(""),C("")}),[e]);var b=(0,p.D)(H),Z=(0,d.Z)(b,1)[0],w=function(){var n=(0,a.Z)((0,u.Z)().mark((function n(){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s(!0),n.next=3,Z({variables:{concurrencyKey:g,limit:parseInt(f.trim())}});case 3:s(!1),r(),t();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,D.jsxs)(R.Vq,{isOpen:e,title:"Add concurrency limit",onClose:t,children:[(0,D.jsxs)(R.a7,{children:[(0,D.jsx)(h.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,D.jsx)(h.x,{margin:{bottom:16},children:(0,D.jsx)(T.oi,{value:g||"",onChange:function(n){return C(n.target.value)},placeholder:"Concurrency key"})}),(0,D.jsx)(h.x,{margin:{bottom:4},children:"Concurrency limit (1-1000):"}),(0,D.jsx)(h.x,{children:(0,D.jsx)(T.oi,{value:f||"",onChange:function(n){return y(n.target.value)},placeholder:"1 - 1000"})})]}),(0,D.jsxs)(R.cN,{children:[(0,D.jsx)(v.zx,{intent:"none",onClick:t,children:"Cancel"}),(0,D.jsx)(v.zx,{intent:"primary",onClick:w,disabled:!q(f.trim())||!g||c,children:c?"Adding...":"Add limit"})]})]})},V=function(n){var e=n.concurrencyKey,t=n.open,r=n.onClose,i=n.onComplete,o=N.useState(!1),c=(0,d.Z)(o,2),s=c[0],l=c[1],x=N.useState(""),f=(0,d.Z)(x,2),y=f[0],m=f[1];N.useEffect((function(){m("")}),[t]);var j=(0,p.D)(H),C=(0,d.Z)(j,1)[0],b=function(){var n=(0,a.Z)((0,u.Z)().mark((function n(){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l(!0),n.next=3,C({variables:{concurrencyKey:e,limit:parseInt(y.trim())}});case 3:l(!1),i(),r();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),Z=(0,D.jsxs)(D.Fragment,{children:["Edit ",(0,D.jsx)(g.fv,{children:e})]});return(0,D.jsxs)(R.Vq,{isOpen:t,title:Z,onClose:r,children:[(0,D.jsxs)(R.a7,{children:[(0,D.jsx)(h.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,D.jsx)(h.x,{margin:{bottom:16},children:(0,D.jsx)("strong",{children:e})}),(0,D.jsx)(h.x,{margin:{bottom:4},children:"Concurrency limit (1-1000):"}),(0,D.jsx)(h.x,{children:(0,D.jsx)(T.oi,{value:y||"",onChange:function(n){return m(n.target.value)},placeholder:"1 - 1000"})})]}),(0,D.jsxs)(R.cN,{children:[(0,D.jsx)(v.zx,{intent:"none",onClick:r,children:"Close"}),s?(0,D.jsx)(v.zx,{intent:"primary",disabled:!0,children:"Updating..."}):(0,D.jsx)(v.zx,{intent:"primary",onClick:b,disabled:!q(y.trim()),children:"Update limit"})]})]})},J=function(n){var e=n.concurrencyKey,t=n.open,r=n.onClose,i=n.onComplete,o=N.useState(!1),c=(0,d.Z)(o,2),s=c[0],l=c[1],x=(0,p.D)(H),f=(0,d.Z)(x,1)[0],h=function(){var n=(0,a.Z)((0,u.Z)().mark((function n(){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l(!0),n.next=3,f({variables:{concurrencyKey:e,limit:0}});case 3:l(!1),i(),r();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),y=(0,D.jsxs)(D.Fragment,{children:["Delete ",(0,D.jsx)(g.fv,{children:e})]});return(0,D.jsxs)(R.Vq,{isOpen:t,title:y,onClose:r,children:[(0,D.jsxs)(R.a7,{children:["Delete concurrency limit\xa0",(0,D.jsx)("strong",{children:e}),"?"]}),(0,D.jsxs)(R.cN,{children:[(0,D.jsx)(v.zx,{intent:"none",onClick:r,children:"Close"}),s?(0,D.jsx)(v.zx,{intent:"danger",disabled:!0,children:"Deleting..."}):(0,D.jsx)(v.zx,{intent:"danger",onClick:h,children:"Delete limit"})]})]})},M=function(n){var e=n.runIds,t=n.onClose,r=n.title,i=(0,x.a)(en,{variables:{limit:25,filter:{runIds:e||[]}},skip:!e||!e.length}).data,o=(0,p.D)(nn),c=(0,d.Z)(o,1)[0],s=N.useCallback((function(n){return P.cv.has(n.status)?[(0,D.jsx)(_.sN,{icon:"status",text:"Free concurrency slots for run",onClick:(0,a.Z)((0,u.Z)().mark((function e(){var r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({variables:{runId:n.id}});case 2:if(i=e.sent,null===(r=i.data)||void 0===r||!r.freeConcurrencySlotsForRun){e.next=6;break}return e.next=6,(0,E.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"});case 6:t();case 7:case"end":return e.stop()}}),e)})))},"free-concurrency-slots")]:[]}),[c,t]);return(0,D.jsxs)(R.Vq,{isOpen:!!e&&e.length>0,title:r,onClose:t,style:{width:"60%",minWidth:"400px"},children:[(0,D.jsx)(h.x,{padding:{vertical:16},children:i?"Runs"===i.pipelineRunsOrError.__typename?(0,D.jsx)($.AL,{runs:i.pipelineRunsOrError.results,additionalActionsForRun:s}):(0,D.jsxs)(h.x,{padding:{vertical:64},children:[(0,D.jsx)(C.t,{icon:"error",title:"Query Error",description:"PythonError"===i.pipelineRunsOrError.__typename?i.pipelineRunsOrError.message:"There was a problem querying for these runs."}),";"]}):(0,D.jsx)(h.x,{padding:{vertical:64},children:(0,D.jsx)(y.$,{purpose:"section"})})}),(0,D.jsx)(R.cN,{children:(0,D.jsx)(v.zx,{intent:"none",onClick:t,children:"Close"})})]})},W=(0,f.Ps)(r||(r=(0,l.Z)(["\n  fragment ConcurrencyLimitFragment on ConcurrencyKeyInfo {\n    concurrencyKey\n    slotCount\n    activeRunIds\n    activeSlotCount\n  }\n"]))),X=(0,f.Ps)(i||(i=(0,l.Z)(["\n  query InstanceConcurrencyLimitsQuery {\n    instance {\n      id\n      info\n      supportsConcurrencyLimits\n      concurrencyLimits {\n        ...ConcurrencyLimitFragment\n      }\n    }\n  }\n\n  ","\n"])),W),H=(0,f.Ps)(o||(o=(0,l.Z)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]))),nn=(0,f.Ps)(c||(c=(0,l.Z)(["\n  mutation FreeConcurrencySlotsForRun($runId: String!) {\n    freeConcurrencySlotsForRun(runId: $runId)\n  }\n"]))),en=(0,f.Ps)(s||(s=(0,l.Z)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          ... on PipelineRun {\n            ...RunTableRunFragment\n          }\n        }\n      }\n      ... on PythonError {\n        ...PythonErrorFragment\n      }\n    }\n  }\n\n  ","\n  ","\n"])),$.ZZ,F.B)},8589:function(n,e,t){t.d(e,{Z:function(){return C}});var r=t(47515),i=t(16185),o=t(78193),c=t(72691),s=t(39707),l=t(22e3),u=t(32667),a=t(85048),d=t(26819),x=t(35936),p=o.memo((function(){var n=o.useContext(a.Z).daemons;return n?(0,x.jsx)(d.a,{content:n.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,x.jsx)(l.JO,{name:"warning",color:u.w.Yellow500})}):null})),f=t(44229),h=t(62459),y=o.memo((function(n){var e=n.placeholder,t=o.useContext(a.Z).codeLocations;return t?"spinner"===t.type?(0,x.jsx)(f.u,{content:t.content,placement:"bottom",children:(0,x.jsx)(h.$,{purpose:"body-text",fillColor:u.w.Gray300})}):(0,x.jsx)(d.a,{content:t.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,x.jsx)(l.JO,{name:"warning",color:u.w.Yellow500})}):e?(0,x.jsx)("div",{style:{width:"16px"}}):null})),m=t(4248),j=t(671),g=t(76612),C=function(n){var e=n.refreshState,t=n.tab,l=o.useContext(j.N).healthTitle,u=(0,g._)(),a=(0,c.gV)().flagInstanceConcurrencyLimits;return(0,x.jsxs)(r.x,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,x.jsxs)(i.mQ,{selectedTabId:t,children:[(0,x.jsx)(m.f,{id:"locations",title:"Code locations",to:"/locations",icon:(0,x.jsx)(y,{placeholder:!1})}),(0,x.jsx)(m.f,{id:"health",title:l,to:"/health",icon:(0,x.jsx)(p,{})}),u&&a?(0,x.jsx)(m.f,{id:"concurrency",title:"Concurrency limits",to:"/concurrency"}):null,u?(0,x.jsx)(m.f,{id:"config",title:"Configuration",to:"/config"}):null]}),e?(0,x.jsx)(r.x,{padding:{bottom:8},children:(0,x.jsx)(s.xi,{refreshState:e})}):null]})}},4248:function(n,e,t){t.d(e,{f:function(){return a}});var r=t(33028),i=t(59740),o=t(60319),c=t(16185),s=(t(78193),t(97412)),l=t(35936),u=["to","title","disabled"],a=(0,o.ZP)((function(n){var e=n.to,t=n.title,o=n.disabled,a=(0,i.Z)(n,u),d=(0,c.xv)(n),x=(0,c.BY)(n),p="string"===typeof t?t:void 0;return(0,l.jsx)(s.rU,(0,r.Z)((0,r.Z)((0,r.Z)({to:o?"#":e,title:p},d),a),{},{children:x}))})).withConfig({displayName:"TabLink",componentId:"sc-1rmmczd-0"})(["",""],c.gA)},16185:function(n,e,t){t.d(e,{BY:function(){return h},OK:function(){return j},gA:function(){return m},mQ:function(){return g},xv:function(){return f}});var r,i=t(59740),o=t(33028),c=t(71171),s=t(60319),l=t(78193),u=t(32667),a=t(22e3),d=t(57103),x=t(35936),p=["selectedTabId","children","onChange","size"],f=function(n){var e=n.selected,t=n.disabled;return{role:"tab",tabIndex:t?-1:0,"aria-disabled":t,"aria-expanded":e,"aria-selected":e}},h=function(n){var e=n.title,t=n.count,r=n.icon;return(0,x.jsxs)(x.Fragment,{children:[e,r,void 0!==t?(0,x.jsx)(y,{children:"indeterminate"===t?"\u2013":t}):null]})},y=s.ZP.div.withConfig({displayName:"Tabs__Count",componentId:"sc-11fd6a5-0"})(["display:inline;font-family:",";font-size:14px;font-weight:500;letter-spacing:-0.02%;padding:0 4px;color:",";background:",";"],d.b.monospace,u.w.Gray900,u.w.Gray100),m=(0,s.iv)(r||(r=(0,c.Z)(["\n  background: none;\n  border: none;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: 600;\n  padding: ",";\n  box-shadow: "," 0 -2px 0 inset;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  gap: 6px;\n\n  &,\n  & a {\n    cursor: pointer;\n    user-select: none;\n    color: ",";\n  }\n\n  & "," {\n    background: ",";\n  }\n\n  /* Focus outline only when using keyboard, not when focusing via mouse. */\n  &:focus {\n    outline: none !important;\n    box-shadow: ","\n      0 -2px 0 inset;\n  }\n\n  &:hover {\n    &,\n    a {\n      text-decoration: none;\n      color: ",";\n    }\n    "," {\n      color: ",";\n    }\n  }\n"])),(function(n){return"small"===n.$size?"10px 0":"16px 0"}),(function(n){return n.selected?u.w.Blue500:"transparent"}),(function(n){var e=n.selected,t=n.disabled;return e?u.w.Blue500:t?u.w.Gray300:u.w.Gray700}),a.a1,(function(n){var e=n.selected,t=n.disabled;return e?u.w.Blue500:t?u.w.Gray300:""}),(function(n){var e=n.selected,t=n.disabled;return e?u.w.Blue500:t?"transparent":u.w.Blue200}),(function(n){var e=n.selected,t=n.disabled;return e?u.w.Blue700:t?u.w.Gray300:u.w.Blue700}),a.a1,(function(n){var e=n.selected,t=n.disabled;return e?u.w.Blue700:t?u.w.Gray300:""})),j=(0,s.ZP)((function(n){var e=f(n),t=h(n),r="string"===typeof n.title?n.title:void 0;return(0,x.jsx)("button",(0,o.Z)((0,o.Z)((0,o.Z)({},n),e),{},{title:r,type:"button",children:t}))})).withConfig({displayName:"Tabs__Tab",componentId:"sc-11fd6a5-1"})(["",""],m),g=(0,s.ZP)((function(n){var e=n.selectedTabId,t=n.children,r=n.onChange,c=n.size,s=void 0===c?"large":c,u=(0,i.Z)(n,p);return(0,x.jsx)("div",(0,o.Z)((0,o.Z)({},u),{},{role:"tablist",children:l.Children.map(t,(function(n){return n?l.cloneElement(n,(0,o.Z)({selected:n.props.selected||n.props.id===e,$size:s},r?{onClick:function(){return r(n.props.id)}}:{})):null}))}))})).withConfig({displayName:"Tabs",componentId:"sc-11fd6a5-2"})(["display:flex;gap:16px;font-size:",";line-height:",";font-weight:600;"],(function(n){return"small"===n.size?"12px":"14px"}),(function(n){return"small"===n.size?"16px":"20px"}))}}]);
//# sourceMappingURL=333.d48b1b99.chunk.js.map