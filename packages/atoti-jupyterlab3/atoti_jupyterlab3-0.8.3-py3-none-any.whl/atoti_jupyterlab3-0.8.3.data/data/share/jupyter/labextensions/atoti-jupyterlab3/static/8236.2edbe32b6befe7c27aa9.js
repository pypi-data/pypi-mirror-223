(self.webpackChunkatoti_jupyterlab3=self.webpackChunkatoti_jupyterlab3||[]).push([[8236],{16230:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>xs});var n=s(61210),o=s(64859),i=s(5172),r=s(67667),a=s(98082);const d="default",l="ROLE_ADMIN",c="ROLE_USER",u="anonymousUser";var h=s(90477);var g=s(71840),p=s(29966),m=s(61623);const y="en-US",f={en:"en-US"},w=e=>{if(!e)return y;const t=e.get("locale").composite,s=f[t];return void 0===s?(console.error(`Atoti does not support JupyterLab's ${t} locale, falling back to en-US.`),y):s},x=async(e,{pluginRegistry:t})=>{const[n,{default:o}]=await Promise.all([(0,m.pr1)(e),s(6974)(`./${e}`)]);return{...n,...(0,m.dUG)(t,e),...(0,p.treeToFlatMap)(o)}};class v{static async create({pluginRegistry:e,settingRegistry:t}){const s=await(t?t.load("@jupyterlab/translation-extension:plugin"):void 0),n=w(s),o=await x(n,{pluginRegistry:e});return new v({initialConfig:{locale:n,messages:o},pluginRegistry:e,translationSettings:s})}_changed=new g.Signal(this);constructor({initialConfig:e,pluginRegistry:t,translationSettings:s}){this._config=e,s&&s.changed.connect((async()=>{const e=w(s),n=await x(e,{pluginRegistry:t});this._config={locale:e,messages:n},this._changed.emit()}))}get changed(){return this._changed}get config(){return this._config}}const C="atoti-ant-style",b=async e=>{e.theme||(await new Promise((t=>{const s=()=>{e.themeChanged.disconnect(s),t(void 0)};e.themeChanged.connect(s)})),await b(e))};class k{static async create(e){const t=document.createElement("style");t.id=C,t.setAttribute("rel","stylesheet"),document.querySelector("head").append(t),await b(e);const n=async()=>{const n=!e.theme||e.isLight(e.theme),o=n?await s.e(2733).then(s.t.bind(s,12733,17)):await s.e(860).then(s.t.bind(s,10860,17));return t.innerHTML=o.default,n?m.xjl:m.MuJ},o=await n();return new k({initialTheme:o,syncTheme:n,themeManager:e})}_changed=new g.Signal(this);constructor({initialTheme:e,syncTheme:t,themeManager:s}){this._theme=e,s.themeChanged.connect((async()=>{this._theme=await t(),this._changed.emit()}))}get changed(){return this._changed}get theme(){return this._theme}}var S=s(48456),j=s(78918),M=s(15923),E=s(47078),I=s(14456),P=s.n(I),T=s(31929),_=s(56271),L=s(51625),R=s(68372),$=s(75132),D=s(11187);function O(){return O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},O.apply(this,arguments)}const A="ant-root",U=(0,_.forwardRef)((({children:e,height:t,...s},n)=>(0,E.jsx)("div",O({},s,{ref:n,className:A,css:{height:t}}),e))),N=()=>{const e=document.querySelector(`#${m.pt}`);if(!e)throw new Error("Missing overlay root DOM node.");return e};var W=s(88671);const q="Content-Type",B="application/json",F=(e,{requestInit:t={}}={})=>async(s,{body:n,contentType:o=B,method:i,signal:r}={})=>{const a=`${e}${s.startsWith("/")?s:`/${s}`}`,d=await fetch(a,{...t,body:n,headers:{...t.headers,...o?{[q]:o}:{}},method:i,...r?{signal:r}:{}});if(!d.ok){const e=await d.json();throw console.error(e),new Error(`Unexpected response status: ${d.status}`)}const l=d.headers.get(q)===B;let c=await(l?d.json():d.text());return l&&"object"==typeof c&&"success"===c.status&&"data"in c&&(c=c.data),c},H=W.PageConfig.getBaseUrl(),z=W.URLExt.join(H,"proxy"),K=async(e,{jupyterServerProxyEnabled:t})=>{const{hostname:s}=new URL(H),n="url"in e?e.url:`${e.https?"https":"http"}://${s}:${e.port}`,o=[];if(t&&!n.startsWith(z)){const{hostname:e,pathname:t,port:i,protocol:r}=new URL(n),a=i||("https:"===r?"443":"80"),d=t&&"/"!==t?[t]:[];o.push(W.URLExt.join(z,a,...d)),e!==s&&o.push(W.URLExt.join(z,`${e}:${a}`,...d))}o.push(n);for(const e of o)try{const t=F(e);return{sessionUrl:e,versions:await t("versions/rest")}}catch{}throw new Error("Cannot access the session after trying "+(1===o.length?`this URL: ${o[0]}`:`these URLs: ${o.join(", ")}`))},V=(e,t="")=>{if(""===t){const{pathname:t}=new URL(e);return`${e}${""===t||"/"===t?"":"/"}`}return`${e}/${t}`};var Z=s(86218);const Q=e=>{const t=new Headers(e).get("authorization");if(!t)throw new Error(`Missing Authorization header in ${JSON.stringify(e)}.`);(e=>{(({username:e,userRoles:t})=>{if(!(e!==u||t.includes(c)&&t.includes(l)))throw new Error(`Anonymous user should have roles ROLE_USER and ROLE_ADMIN but had roles: ${t}.`)})(e);const{username:t}=e;if(t!==u)throw new Error(`Expected username to be anonymousUser but was ${t}.`)})((e=>{const{authorities:t,sub:s}=JSON.parse(atob(e.split(".",2).pop()));return{username:s,userRoles:t}})(t.split(" ",2).pop()))};class J{static async create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:s,sessionLocation:n}){const o="url"in n;o||Q(t);const{sessionUrl:i,versions:r}=await K(n,{jupyterServerProxyEnabled:e}),a=null===t?void 0:{credentials:"include",headers:t,mode:"cors"},[d,l]=["pivot","content"].map((e=>{const t=[`activeviam/${e}`,e];for(const e of t)if(e in r.apis)return r.apis[e].versions[0];throw new Error(`One of ${t} missing in the server services: ${Object.keys(r.apis)}.`)})),c=(0,m.Vse)({requestInit:a,url:i,version:d});await c.loadDataModel();const u=(0,m.u$l)({requestInit:a,url:i,version:l}),h=F(i,{requestInit:a});return new J({activePivotClient:c,contentClient:u,fetch:h,id:s,isQuerySession:o,versions:r})}_disposed=new g.Signal(this);_isDisposed=!1;subscriberCount=0;constructor({activePivotClient:e,contentClient:t,fetch:s,id:n,isQuerySession:o,versions:i}){this.activePivotClient=e,this.contentClient=t,this.fetch=s,this.stopSyncingDataModel=o?Z.noop:((e,{processDataModel:t=h.identity}={})=>{const s=`${e.url.replace(/^http/,"ws")}/atoti/discovery`;let n;const o=o=>{"connected"===o?(n=new WebSocket(s),n.addEventListener("message",(({data:s})=>{const n=JSON.parse(s),o=t(n);e.__UNSAFE_setDataModel__(o)}))):"disconnected"===o&&n&&(n.close(),n=void 0)};return o(e.connectionStatus),e.addConnectionStatusListener(o),()=>{e.removeConnectionStatusListener(o),n&&n.close()}})(e),this.id=n,this.isQuerySession=o,this.versions=i}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),this.activePivotClient.disconnect(),this.stopSyncingDataModel(),g.Signal.clearData(this))}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}subscribe(){this.subscriberCount++}unsubscribe(){this.subscriberCount--,0===this.subscriberCount&&this.dispose()}}var Y=s(36671);const X=({children:e,description:t,icon:s,id:n})=>{const{formatMessage:o}=(0,$.useIntl)();return(0,E.jsx)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"center"}},(0,E.jsx)(Y.default,{description:(0,E.jsx)("span",{css:{color:"var(--jp-ui-font-color1)"}},(0,E.jsx)("span",{css:{fontSize:"var(--jp-ui-font-size2)"}},o({id:`${n}.title`})),(0,E.jsx)("br",null),(0,E.jsx)("span",{css:{color:"var(--jp-ui-font-color2)",fontSize:"var(--jp-ui-font-size1)"}},t??o({id:`${n}.description`}))),image:s,imageStyle:{fontSize:42,height:60}},e))};var G=s(15605);const ee=({hasSnapshot:e})=>e?(0,E.jsx)(X,{icon:(0,E.jsx)(G.PictureOutlined,null),id:"widget.snapshotSelected"}):(0,E.jsx)(X,{icon:(0,E.jsx)(G.ApiOutlined,null),id:"widget.waitingForConnection"});var te=s(42765);const se=(e,{getCurrentValue:t})=>{const s=(0,_.useCallback)((t=>e?(e.connect(t),()=>{e.disconnect(t)}):Z.noop),[e]);return(0,te.useSubscription)({getCurrentValue:t,subscribe:s})},ne=(e,{property:t,sender:s})=>{const n=(0,_.useCallback)((()=>{if(s)return s[t]}),[t,s]);return se(e,{getCurrentValue:n})},oe=(0,_.createContext)(void 0),ie=()=>(0,_.useContext)(oe),re=(0,_.createContext)(void 0),ae={username:u,userRoles:[l,c]},de=({children:e,sessionId:t})=>{const s=ie(),n=(0,_.useCallback)((()=>s.get(t)),[s,t]),o=se(s.changed,{getCurrentValue:n}),i=(0,_.useMemo)((()=>{const e={};return o&&(e[d]=o.activePivotClient),e}),[o]),r=(0,_.useMemo)((()=>o?.contentClient),[o]);return o?(0,E.jsx)(m.drd,{value:ae},(0,E.jsx)(m.u_E,{value:{activePivot:i,contentClient:r}},(0,E.jsx)(re.Provider,{value:o},e))):(0,E.jsx)(ee,null)},le=()=>(0,_.useContext)(re);class ce{_changed=new g.Signal(this);sessionClients={};sessionClientCreations={};get changed(){return this._changed}get(e){return this.sessionClients[e]}async getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:s,sessionLocation:n}){const o=this.get(s);if(o){const{activePivotClient:e}=o;return"disconnected"===e.connectionStatus&&await e.connect(),o}return s in this.sessionClientCreations||(this.sessionClientCreations[s]=(async()=>{const o=await J.create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:s,sessionLocation:n}),i=()=>{Reflect.deleteProperty(this.sessionClients,s),this._changed.emit(),o.disposed.disconnect(i)};o.disposed.connect(i),this.sessionClients[s]=o,Reflect.deleteProperty(this.sessionClientCreations,s),this._changed.emit()})()),await this.sessionClientCreations[s],this.sessionClients[s]}}const ue=e=>"mapping"in e;var he=s(58105),ge=s(76702);class pe{constructor(e,t){this.onChange=t,this.index=0,this.states=[e]}get current(){return this.states[this.index]}get canRedo(){return this.index<this.states.length-1}get canUndo(){return this.index>0}set(e){e!==this.current&&(this.index++,this.states.length=this.index,this.states.push(e),this.onChange())}redo(){if(!this.canRedo)throw new Error("Cannot redo");this.index++,this.onChange()}undo(){if(!this.canUndo)throw new Error("Cannot undo");this.index--,this.onChange()}}const me="atoti",ye="widget",fe=360,we=e=>e.get(me)??void 0,xe=e=>{const t=e[ye];return{...e,[ye]:t?(0,m.mh8)(t):void 0}},ve=e=>{const t=e[ye];return{...e,[ye]:t?(0,m.hNS)(t):void 0}},Ce=({code:e,state:t})=>({cell_type:"code",metadata:{[me]:ve({[ye]:t})},source:e}),be=e=>we(e)?.height??fe;class ke{constructor(e,{widgetPlugins:t}){this.cellMetadata=e,this._changed=new g.Signal(this),this._isDeferredChanged=new g.Signal(this),this._isDeferred=!1,this._isDisposed=!1,this.updatingState=!1;const s=we(this.cellMetadata);this.undoableState=new pe(s?xe(s):void 0,(()=>{this.updatingState=!0;try{this.current?this.cellMetadata.set(me,ve(this.current)):this.cellMetadata.delete(me)}finally{this.updatingState=!1}this._changed.emit()}));const n=(e,{key:t,newValue:s})=>{t!==me||this.updatingState||(this.current=((e,t)=>{if(!t)return;const s=xe(t);return e?(n=e,o=s,(0,ge.produce)(n,(e=>{const t=(0,he.compare)(e,o);(0,he.applyPatch)(e,t)}))):s;var n,o})(this.current,s))};this.cellMetadata.changed.connect(n),this.disconnectFromCellMetadataChangedSignal=()=>{this.cellMetadata.changed.disconnect(n)},this.widgetPlugins=t}get defaultWidgetState(){return this.widgetPlugins[0].initialState}get canRedo(){return this.undoableState.canRedo}get canUndo(){return this.undoableState.canUndo}get changed(){return this._changed}get current(){return this.undoableState.current}set current(e){this.undoableState.set(e)}dispose(){this.isDisposed||(this._isDisposed=!0,this.disconnectFromCellMetadataChangedSignal(),g.Signal.clearData(this))}get isDeferred(){return this._isDeferred}set isDeferred(e){this._isDeferred=e,this._isDeferredChanged.emit()}get isDeferredChanged(){return this._isDeferredChanged}get isDisposed(){return this._isDisposed}setHeight(e){this.setMetadataProperty("height",e)}setWidgetState(e){this.setMetadataProperty(ye,e)}redo(){this.undoableState.redo()}undo(){this.undoableState.undo()}setMetadataProperty(e,t){const{current:s}=this;this.current={...s,[e]:t}}}const Se=e=>{const t=ne(e.isDeferredChanged,{property:"isDeferred",sender:e}),s=(0,_.useCallback)((t=>{e.isDeferred=t}),[e]);return{isDeferred:t,setIsDeferred:s}},je=e=>{const t=(0,_.useCallback)((t=>{e.setWidgetState(t)}),[e]),{[ye]:s}=ne(e.changed,{property:"current",sender:e})??{};return{setWidgetState:t,widgetState:s}},Me=(0,_.createContext)(void 0),Ee=()=>(0,_.useContext)(Me),Ie=(0,_.createContext)(void 0),Pe=({cellMetadata:e,children:t,hasSnapshot:s})=>{const n=Ee(),o=(0,_.useCallback)((()=>n.get(e)),[e,n]),i=se(n.created,{getCurrentValue:o});return i?(0,E.jsx)(Ie.Provider,{value:i},t):(0,E.jsx)(ee,{hasSnapshot:s})},Te=()=>(0,_.useContext)(Ie);class _e{_created=new g.Signal(this);widgetStateTrackers=new WeakMap;constructor({widgetPlugins:e}){this.widgetPlugins=e}get created(){return this._created}get(e){return this.widgetStateTrackers.get(e)}getOrCreate(e){return this.widgetStateTrackers.has(e)||(this.widgetStateTrackers.set(e,new ke(e,{widgetPlugins:this.widgetPlugins})),this._created.emit()),this.get(e)}}const Le=(0,_.createContext)(void 0),Re=(0,_.createContext)(!1),$e=(0,_.createContext)(void 0),De=({children:e,value:{intlTracker:t,jupyterLab:s,jupyterServerProxyEnabled:n,notebookTracker:o,pluginRegistry:i,sessionClients:r,themeTracker:a,widgetStateTrackers:d}})=>{const{locale:l,messages:c}=ne(t.changed,{property:"config",sender:t}),u=ne(a.changed,{property:"theme",sender:a});return(0,E.jsx)(T.default,{getPopupContainer:N},(0,E.jsx)(L.DndProvider,{backend:R.HTML5Backend},(0,E.jsx)($.IntlProvider,{locale:l,messages:c},(0,E.jsx)(m.f6W,{value:u},(0,E.jsx)(m.oPk,{value:i},(0,E.jsx)(Le.Provider,{value:s},(0,E.jsx)(Re.Provider,{value:n},(0,E.jsx)($e.Provider,{value:o},(0,E.jsx)(oe.Provider,{value:r},(0,E.jsx)(Me.Provider,{value:d},e))))))))))},Oe=()=>(0,_.useContext)(Le),Ae=()=>(0,_.useContext)(Re),Ue=()=>(0,_.useContext)($e),Ne=(0,_.createContext)(null),We=Ne.Provider,qe=()=>(0,_.useContext)(Ne),Be=(e,t)=>{for(let s=0;s<e.length;s++){const n=e.get(s);if(t(n))return n}},Fe="text/html",He="0.8.3".split(".",1).pop(),ze=`application/vnd.atoti.link.v${He}+json`,Ke=`application/vnd.atoti.widget.v${He}+json`,Ve=`application/vnd.atoti.convert-query-result-to-widget.v${He}+json`,Ze=({children:e})=>{const[t,s]=(0,_.useState)(),n=(0,_.useRef)(null);return(0,_.useEffect)((()=>{const e=n.current;e&&void 0===t&&s(null!==e.closest(".jp-LinkedOutputView"))}),[t]),void 0===t?(0,E.jsx)("div",{ref:n}):e(t)};var Qe=s(4863),Je=s(65400),Ye=s(56391);const Xe=()=>{const e=Te(),{formatMessage:t}=(0,$.useIntl)();return(0,E.jsx)(X,{icon:(0,E.jsx)(G.MehOutlined,null),id:"widget.errored"},(0,E.jsx)(Je.default,{danger:!0,onClick:()=>{e.current=void 0}},(0,E.jsx)(G.ClearOutlined,null)," ",t({id:"widget.reset"})),e.canUndo?(0,E.jsx)(Je.default,{css:{marginLeft:"4px !important",marginTop:"4px !important"},onClick:()=>{e.undo()}},(0,E.jsx)(G.UndoOutlined,null)," ",t({id:"aui.plugins.menu-item.undo.key"})):null)},Ge=({children:e,widgetLoadingTracker:t})=>{const s=(0,_.useCallback)((async e=>{t&&await t.handleError(e)}),[t]),n=Te(),o=je(n);return(0,E.jsx)(Ye.ErrorBoundary,{FallbackComponent:Xe,resetKeys:[o],onError:s},e)},et={"*":{"-ms-overflow-style":"none","scrollbar-width":"none"},"*::-webkit-scrollbar":{display:"none"}},tt="http://www.w3.org/2000/svg",st=(e,{elements:t,matchedSelectors:s,styles:n})=>{const o=e.selectorText,i=e.style;if(((e,{elements:t,matchedSelectors:s})=>{if(e in s)return s[e];const n=t.some((t=>t.matches(e)));return s[e]=n,s[e]})(o,{elements:t,matchedSelectors:s})){o in n||(n[o]={});const e=n[o];for(const t of i)e[t]=`${i.getPropertyValue(t)}${"important"===i.getPropertyPriority(t)?" !important":""}`}},nt={left:"scrollLeft",top:"scrollTop"},ot=e=>{const{clientHeight:t,clientWidth:s}=e,n=document.createElementNS(tt,"svg");n.setAttribute("xmlns",tt);const o=document.createElementNS(tt,"foreignObject");n.setAttribute("height",String(t)),n.setAttribute("width",String(s)),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0");const i=document.createElement("style"),r=(e=>{if(!document.getElementById(C))throw new Error("The stylesheet #atoti-ant-style is missing");const t={},s={},n=[e,...e.querySelectorAll("*")],o=[...document.styleSheets];for(const e of o)try{const o=e.cssRules;for(const e of o)st(e,{elements:n,matchedSelectors:t,styles:s})}catch{}return s})(e),a=(d={...r,...et,".atoti-hidden-in-snapshot":{display:"none"}},Object.entries(d).map((([e,t])=>`${e} {${Object.entries(t).map((([e,t])=>`${e}: ${t}`)).join("; ")}}`)).join("\n"));var d;i.setAttribute("type","text/css"),i.append(document.createTextNode(a)),n.append(o),o.append(i);const l=document.createElement("div");return l.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),l.setAttribute("style",`height: ${t}px; width: ${s}px;`),l.append((e=>{const t=[e,...e.querySelectorAll("*")],s=e.cloneNode(!0),n=[s,...s.querySelectorAll("*")];for(const[e,s]of n.entries()){const n=t[e];for(const[e,t]of Object.entries(nt)){const o=e,i=n[t];if(0!==i)for(const e of s.children){const{style:s}=e;if(""!==s[o])throw new Error(`Expected child of element with ${t} property of ${i} to have no ${o} style property but has ${s[o]}.`);s[o]=-i+"px"}}}return s})(e)),o.append(l),n},it=e=>{const t=document.createElementNS(tt,"svg");return t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttribute("height",String(e.clientHeight)),t.setAttribute("width",String(e.clientWidth)),((e,t)=>{const{height:s,width:n}=e[0].getBoundingClientRect();t.setAttribute("viewBox",`0 0 ${n} ${s}`);for(const s of e)for(const e of s.children)t.append(e.cloneNode(!0))})(e.querySelectorAll(".svg-container .main-svg"),t),t},rt=(e,{isPlotlyChart:t})=>(e=>{const t=(new XMLSerializer).serializeToString(e);return`<img src="data:image/svg+xml;charset=utf8,${encodeURIComponent(`<?xml version="1.0" standalone="no"?>${t}`)}">`})((t?it:ot)(e)),at=async({code:e,notebookTracker:t,state:s})=>{const n=t.currentWidget;if(!n)throw new Error("Notebook has no current panel.");const o=n.model;if(!o)throw new Error("Current notebook panel has no model.");const r=o.contentFactory.createCodeCell({cell:Ce({code:e,state:s})}),a=n.content;o.cells.insert(a.activeCellIndex+1,r),a.activeCellIndex++;const d=a.activeCell;return await i.NotebookActions.run(a,n.sessionContext),d},dt=e=>{const t=ne(e.activeCellChanged,{property:"activeCell",sender:e});if(t&&(0,S.isCodeCellModel)(t.model))return t.model},lt=({children:e})=>{const{formatMessage:t}=(0,$.useIntl)(),s=(()=>{const e=Ue(),t=dt(e),{cellMetadata:s}=qe();return!!t&&t.metadata===s})(),{[d]:n}=(0,m.ZmX)(),[o,i]=(0,_.useState)(!1),r=(0,_.useCallback)((()=>{i(!0)}),[]),a="disconnected"===n;return(0,_.useEffect)((()=>{i(!a)}),[a]),(0,E.jsx)(_.Fragment,null,s&&a&&!o?(0,E.jsx)("div",{css:{padding:4,position:"absolute",width:"100%",zIndex:1},className:"atoti-hidden-in-snapshot"},(0,E.jsx)(Qe.default,{closable:!0,showIcon:!0,message:t({id:"widget.sessionDisconnected"}),type:"warning",onClose:r})):null,e)},ct=({children:e,widgetLoadingTracker:t})=>(0,E.jsx)(lt,null,(0,E.jsx)(Ge,{widgetLoadingTracker:t},e)),ut=()=>{const{queryId:e}=qe(),t=Te(),{isDeferred:s}=Se(t),{setWidgetState:n,widgetState:o=t.defaultWidgetState}=je(t);return(0,E.jsx)(m.$LY,{isDeferred:s,queryId:e,widgetState:o,onChange:n})},ht=()=>{const{cellMetadata:e,mimeModel:t,sessionId:s}=qe();return(0,E.jsx)(U,null,(0,E.jsx)(Pe,{cellMetadata:e,hasSnapshot:Boolean(t.data[Fe])},(0,E.jsx)(de,{sessionId:s},(0,E.jsx)(ct,null,(0,E.jsx)(ut,null)))))};class gt{toldLoadingDone=!1;constructor({sessionClient:e,widgetId:t}){this.sessionClient=e,this.widgetId=t}async done(){if(this.toldLoadingDone||this.sessionClient.isQuerySession)return;this.toldLoadingDone=!0;const e=`${this.sessionClient.versions.apis.atoti.versions[0].restPath}/widgets/${this.widgetId}/loading`;await this.sessionClient.fetch(e,{method:"DELETE"})}async handleError(e){await this.done()}}class pt{_changed=new g.Signal(this);messages=new WeakMap;constructor({cellModels:e}){this.cellModels=e}get changed(){return this._changed}get(e){return this.messages.get(e)}register(e){this._changed.emit(),e.registerCommTarget("atoti-widget",((e,{content:{data:t}})=>{const s=t;try{const{cellId:e}=s,t=(0,j.toArray)(this.cellModels).find((({id:t})=>e===t));if(!t)throw new Error(`Missing model for cell #${e}`);if(!(0,S.isCodeCellModel)(t))throw new Error(`Expected cell #${e} to be a code cell`);const n=Be(t.outputs,(e=>void 0!==e.data[Ke]));if(!n)throw new Error(`Expected cell #${e} to have a widget output`);this.messages.set(n,s),this._changed.emit()}catch(e){console.error(e)}}))}}const mt="atoti-sidebar",yt=({jupyterLab:e})=>{e.shell.activateById(mt)};var ft=s(3992),wt=s(68469),xt=s(45982),vt=s(64749),Ct=s(94055),bt=s(79839);const{OptGroup:kt,Option:St}=vt.Z,jt=({onChange:e,queryId:t,widgetState:s})=>{const{formatMessage:n}=(0,$.useIntl)(),o=(0,bt.uU)({queryId:t,widgetState:s}),i=(e=>{const t=(0,m.h0_)(e),s=(0,_.useMemo)((()=>{const e=[];for(const s of t)(0,bt.vo)(s)&&e.push(s);return e}),[t]);return s})((0,m.ANR)()),{mapping:r,widgetKey:a}=(0,m.jl5)(s),{attributes:d}=i.find((({key:e})=>e===a)),l=(0,_.useMemo)((()=>{const e={};for(const t of Object.values(i)){const i=t.subCategory??"misc";e[i]||(e[i]=[]);const a=t.Icon??G.QuestionOutlined,{maxNumberOfFields:l,status:c}=(0,bt.WS)(r,d,t);e[i].push((0,E.jsx)(St,{key:t.key,disabled:"ok"!==c,value:t.key},(0,E.jsx)(Ct.default,{title:(0,E.jsx)(bt.jW,{isQueryLazyLoaded:o,selectedWidgetState:s,widgetOption:{...t,disabledType:"tooManyNumeric"===c?"numeric":"ordinal",isSwitchDisabled:"ok"!==c,maxNumberOfFields:l}})},(0,E.jsx)(a,{css:{marginRight:4}})," ",n({id:`aui.plugins.widget.${t.key}.key`}))))}return e}),[d,i,n,o,r,s]);return(0,E.jsx)(vt.Z,{css:{height:28,marginBottom:"4px !important",width:"100%"},listHeight:30*Object.keys(i).length,value:a,onChange:t=>{e((0,ge.produce)(s,(e=>{t===e.widgetKey?delete e.switchedTo:e.switchedTo=t})))}},Object.entries(l).map((([e,t])=>(0,E.jsx)(kt,{key:e,label:n({id:`aui.dataVisualization.category.${e}`})},t))))};var Mt=s(31059);const Et=()=>{const e=Te(),{isDeferred:t,setIsDeferred:s}=Se(e),{formatMessage:n}=(0,$.useIntl)();return(0,E.jsx)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",height:22,justifyContent:"flex-end"}},(0,E.jsx)(Mt.Z,{checked:t,onChange:e=>{s(e.target.checked)}},n({id:"sidebar.deferUpdates"})))},{Panel:It}=wt.Z,Pt=({cellId:e,widgetName:t})=>{const{formatMessage:s}=(0,$.useIntl)(),n=(0,m.FgM)(),o=Te(),{setWidgetState:i,widgetState:r=o.defaultWidgetState}=je(o),a=(0,_.useMemo)((()=>({...r,name:t})),[t,r]),{widgetKey:d}=(0,m.jl5)(r),[l]=(0,m.h0_)([d]),[c,u]=(0,_.useState)(!0),h=(0,_.useCallback)((e=>{u(!e.includes("0"))}),[]),g=(0,_.useRef)(null),p=(0,xt.zM)(g),{contentEditor:y,styleEditor:f}=l;if(!y)throw new Error(`All widgets in this extension are expected to have a Content Editor but widget ${d} does not.`);return(0,E.jsx)("div",{css:{display:"flex",flexDirection:"column-reverse",height:"100%",overflowY:c?void 0:"scroll",paddingTop:4}},f?(0,E.jsx)(wt.Z,{ghost:!0,activeKey:c?void 0:"0",css:{backgroundColor:`${n.grayScale[1]} !important`,height:c?36:void 0},onChange:h},(0,E.jsx)(It,{key:"0",css:{".ant-collapse-header":{color:`${n.textColor} !important`}},header:(0,E.jsx)(m.Dxz,{level:3},(0,E.jsx)(G.BgColorsOutlined,null)," ",s({id:"sidebar.style"}))},(0,E.jsx)(f,{widgetState:r,queryId:e,onWidgetChange:i}))):null,(0,E.jsx)("div",{css:{paddingLeft:4,paddingRight:4}},(0,E.jsx)(Et,null)),(0,E.jsx)("div",{ref:g,css:{height:`calc(100% - ${22+(ue(r)?32:0)+(f?36:0)}px)`,paddingLeft:4,paddingRight:4}},(0,E.jsx)("div",{css:{height:p.height}},(0,E.jsx)(y,{widgetState:r,queryId:e,onWidgetChange:i}))),ue(a)?(0,E.jsx)("div",{css:{paddingLeft:4,paddingRight:4}},(0,E.jsx)(jt,{queryId:e,widgetState:a,onChange:i})):null)},Tt=()=>{const e=Ue(),t=dt(e),s=(e=>{ne(e?.outputs.changed,{property:"length",sender:e?.outputs});const t=e?Be(e.outputs,(e=>void 0!==e.data[Ke])):void 0;if(!t)return;const{data:s}=t;return{hasSnapshot:Fe in s,widgetOutput:s[Ke]}})(t);if(!t||!s)return(0,E.jsx)(X,{icon:(0,E.jsx)(m.Iwf,null),id:"sidebar.noWidgetSelected"});const{hasSnapshot:n,widgetOutput:o}=s;return(0,E.jsx)(Pe,{cellMetadata:t.metadata,hasSnapshot:n},(0,E.jsx)(de,{sessionId:o.sessionId},(0,E.jsx)(Ge,null,(0,E.jsx)(Pt,{cellId:t.id,widgetName:o.name??void 0}))))},_t=".atoti-icon.jp-SideBar-tabIcon";class Lt extends ft.Widget{constructor(e){super(),this.id=mt,this.title.caption="Atoti",this.title.iconClass="jp-SideBar-tabIcon atoti-icon";const t=o.ReactWidget.create((0,E.jsx)(_.Fragment,null,(0,E.jsx)(E.Global,{styles:{[_t]:{backgroundColor:"var(--md-grey-700)",backgroundImage:"none",maskImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 256 256'%3E%3Cpath fill='%23fff' d='M165.883 208.19h-75.8l-7.342 25.99H30.456l72.467-213.997h49.82l72.759 213.996h-52.267Zm-10.991-38.818-27.21-94.467-26.904 94.467Z'/%3E%3C/svg%3E%0A\");",maskPosition:"center",maskRepeat:"no-repeat",maskSize:"contain"},[`[data-jp-theme-light="false"] ${_t}`]:{backgroundColor:"var(--md-grey-300)"}}}),(0,E.jsx)(De,{value:e},(0,E.jsx)(Tt,null)))),{classList:s,style:n}=t.node;s.add(A),n.padding="0";const i=new ft.PanelLayout;i.addWidget(t),this.layout=i}}const Rt=({widgetLoadingTracker:e,widgetRef:t})=>{const{queryId:s}=qe(),n=Te(),{isDeferred:o,setIsDeferred:i}=Se(n),{setWidgetState:r,widgetState:a}=je(n),l=a??n.defaultWidgetState,c=(g=e,(0,_.useEffect)((()=>()=>{(async()=>{await g.done()})()}),[g]),(0,_.useCallback)((async()=>{await g.done()}),[g])),u=(({widgetRef:e,widgetState:t})=>{const{mimeModel:s,queryId:n,saveStateSignal:o}=qe(),{widgetKey:i}=(0,m.jl5)(t),r=(0,_.useRef)(!1),a=(0,_.useCallback)((e=>{const{[Fe]:t,...n}=s.data;s.setData({data:void 0===e?n:{...n,[Fe]:e}})}),[s]),{error:l}=(0,m.bAZ)({queryId:n,serverKey:d});return(0,_.useEffect)((()=>{const t=(t,s)=>{"started"===s&&a(r.current&&!l&&e.current?rt(e.current,{isPlotlyChart:/plotly-.+-chart/.test(i)}):void 0)};return o.connect(t),()=>{o.disconnect(t)}}),[l,o,a,e,i]),(0,_.useCallback)((()=>{r.current=!0}),[])})({widgetRef:t,widgetState:l}),h=(0,_.useCallback)((()=>{c(),u()}),[c,u]);var g;return(e=>{const t=Oe();(0,_.useEffect)((()=>{e&&yt({jupyterLab:t})}),[e,t])})(void 0===a),(e=>{(0,_.useEffect)((()=>()=>{e(!1)}),[e])})(i),(()=>{const e=le();(0,_.useEffect)((()=>(e.subscribe(),()=>{e.unsubscribe()})),[e])})(),(0,E.jsx)(m.$LY,{isDeferred:o,queryId:s,widgetState:l,onLoaded:h,onChange:r})};var $t=s(97691);const Dt=e=>void 0!==e,Ot=(...e)=>{if(!window.__UNSTABLE_DATA_TEST_IDS_ENABLED__)return;const t=e[e.length-1];if((0,Z.isPlainObject)(t)){const s=t["data-testid"],n=e.slice(0,-1).filter(Dt);if(s){const e=s.replace("atoti:","");return`atoti:${[...n.filter(Dt),e].join(":")}`}return`atoti:${n.join(":")}`}return`atoti:${e.filter(Dt).join(":")}`},At=(0,_.forwardRef)((({children:e},t)=>{const s=Te(),{height:n,setHeight:o}=(e=>{const t=(0,_.useCallback)((t=>{e.setHeight(t)}),[e]),{height:s=fe}=ne(e.changed,{property:"current",sender:e})??{};return{height:s,setHeight:t}})(s),{widgetName:i}=qe(),r=(0,m.FgM)();return(0,E.jsx)(E.ClassNames,null,(({css:s})=>(0,E.jsx)($t.Resizable,{handleClasses:{bottom:`atoti-resize-handle ${s({backgroundColor:r.grayScale[6],borderRadius:2,borderTop:"unset",height:"4px !important",marginBottom:6,marginLeft:"calc(50% - 16px)",opacity:.4,width:"32px !important"})}`},size:{height:n,width:"100%"},enable:{bottom:!0,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1},css:{"&:hover .atoti-resize-handle":{display:"inherit"},overflow:"hidden",paddingBottom:8},onResizeStop:(e,t,s,i)=>{o(n+i.height)}},(0,E.jsx)(U,{ref:t,"data-testid":Ot("Widget",i)},e))))})),Ut=({html:e})=>{const t=(0,$.useIntl)(),{widgetName:s}=qe();return(0,E.jsx)("div",{dangerouslySetInnerHTML:{__html:e},css:{cursor:"help"},"data-testid":Ot("WidgetSnapshot",s),title:t.formatMessage({id:"widget.snapshotSelected.description"})})},Nt=()=>{const e=(0,_.useRef)(null),{cellMetadata:t,mimeModel:s,sessionId:n}=qe(),o=(()=>{const e=Ae(),t=ie(),{cellMetadata:s,mimeModel:n,sessionId:o,sessionLocation:i,widgetComm:r}=qe(),a=Ee(),d=((e,t)=>{const s=(0,_.useCallback)((()=>e.get(t)),[t,e]);return se(e.changed,{getCurrentValue:s})})(r,n),[l,c]=(0,_.useState)(),[u,h]=(0,_.useState)();return(0,_.useEffect)((()=>{let n=!1;return(async()=>{if(u??l??!d)return;const{sessionHeaders:r,widgetId:g}=d;try{const d=await t.getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:r,sessionId:o,sessionLocation:i});a.getOrCreate(s),n||l||c(new gt({sessionClient:d,widgetId:g}))}catch(e){h(e instanceof Error?e:new Error(String(e)))}})(),()=>{n=!0}}),[s,u,e,t,o,i,d,l,a]),u??l})(),i=Ee().get(t);return o instanceof Error?(0,E.jsx)(U,{height:be(t)},(0,E.jsx)(X,{description:o.message,icon:(0,E.jsx)(G.DisconnectOutlined,null),id:"widget.connectionFailed"})):o&&i?(0,E.jsx)(Pe,{cellMetadata:t},(0,E.jsx)(At,{ref:e},(0,E.jsx)(de,{sessionId:n},(0,E.jsx)(ct,{widgetLoadingTracker:o},(0,E.jsx)(Rt,{widgetLoadingTracker:o,widgetRef:e}))))):s.data[Fe]?(0,E.jsx)(Ut,{html:s.data[Fe]}):(0,E.jsx)(U,{height:be(t)},(0,E.jsx)(ee,null))},Wt=()=>(0,E.jsx)(Ze,null,(e=>e?(0,E.jsx)(ht,null):(0,E.jsx)(Nt,null)));class qt extends i.NotebookTools{cleanUpFunctions=[];constructor({cellModels:e,notebookContext:t,sharedContext:s,widgetComm:n}){super({tracker:s.notebookTracker}),this.cellModels=e,this.notebookContext=t,this.sharedContext=s,this.widgetComm=n}async renderModel(e){const{id:t,metadata:s}=((e,{cellModels:t})=>{const s=(0,j.toArray)(t).filter(S.isCodeCellModel).find((({outputs:t})=>Be(t,(t=>t===e))));if(!s)throw new Error(`Could not find matching cell for model: ${JSON.stringify(e)}`);return s})(e,{cellModels:this.cellModels}),n=e.data[Ke],{name:o,sessionId:i,sessionLocation:r}=n;return new Promise((n=>{P().render((0,E.jsx)(De,{value:this.sharedContext},(0,E.jsx)(We,{value:{cellMetadata:s,mimeModel:e,queryId:t,saveStateSignal:this.notebookContext.saveState,sessionId:i,sessionLocation:r,widgetComm:this.widgetComm,widgetName:o}},(0,E.jsx)(Wt,null))),this.node,(()=>{this.cleanUpFunctions.push((()=>{P().unmountComponentAtNode(this.node)})),n()}))}))}handleEvent(e){if(e instanceof MouseEvent&&!e.shiftKey&&e.target){const t=new MouseEvent("contextmenu",{bubbles:!0,clientX:e.clientX,clientY:e.clientY,shiftKey:!0});e.stopPropagation(),e.preventDefault(),t.initEvent(t.type,!0,!0),e.target.dispatchEvent(t)}}onAfterAttach(){const e={capture:!0};this.node.addEventListener("contextmenu",this,e),this.cleanUpFunctions.push((()=>{this.node.removeEventListener("contextmenu",this,e)}))}onBeforeDetach(){for(const e of this.cleanUpFunctions)e()}}class Bt{constructor(e){this.sharedContext=e}createNew(e,t){const{content:s,model:n}=e;if(null===n)throw new Error("Session model should not be null at this time");const{cells:o}=n,i=new pt({cellModels:o});s.rendermime.addFactory({createRenderer:()=>new qt({cellModels:o,notebookContext:t,sharedContext:this.sharedContext,widgetComm:i}),defaultRank:0,mimeTypes:[Ke],safe:!1});const{sessionContext:r}=t,a=(e,{newValue:t})=>{t&&i.register(t)};r.kernelChanged.connect(a);const d=((e,{cellModels:t})=>(s,n)=>{if("idle"===n)for(const s of(0,j.toArray)(t).filter((t=>e.get(t.metadata)?.current&&(0,S.isCodeCellModel)(t)&&t.outputs.length>0&&!Be(t.outputs,(e=>"error"===e.type||void 0!==e.data[Ke])))))e.get(s.metadata).current=void 0})(this.sharedContext.widgetStateTrackers,{cellModels:o});return r.statusChanged.connect(d),new M.DisposableDelegate((()=>{r.kernelChanged.disconnect(a),r.statusChanged.disconnect(d)}))}}const Ft="convert-query-result-to-widget",Ht=`atoti:${Ft}`,zt=".jp-Notebook .jp-CodeCell .dataframe",Kt=e=>{const{activeCell:t}=e,s=t&&(0,S.isCodeCellModel)(t.model)&&Be(t.model.outputs,(e=>void 0!==e.data[Ve]));return s?s.data[Ve]:void 0},Vt=W.URLExt.join(W.PageConfig.getBaseUrl(),"server-proxy","servers-info"),Zt=async()=>{try{if((await fetch(Vt)).ok)return!0}catch{}return!1},Qt=({output:{path:e,sessionLocation:t}})=>{const s=Ae(),[n,o]=(0,_.useState)(),[i,r]=(0,_.useState)();if((0,_.useEffect)((()=>{(async()=>{try{const{sessionUrl:e}=await K(t,{jupyterServerProxyEnabled:s});o(e)}catch(e){r(e)}})()}),[s,t]),void 0!==i)return(0,E.jsx)("div",{css:{paddingLeft:"var(--jp-code-padding)"}},i.message);if(void 0===n)return null;const a=V(n,e);return(0,E.jsx)("div",{css:{paddingLeft:"var(--jp-code-padding)"}},(0,E.jsx)("pre",null,(0,E.jsx)("a",{css:{":hover":{color:"var(--jp-content-link-color)",textDecoration:"underline"},color:"var(--jp-content-link-color)"},"data-testid":Ot("Link"),href:a,target:"_blank",rel:"noopener noreferrer"},a)))};class Jt extends i.NotebookTools{constructor(e){super({tracker:e.notebookTracker}),this.sharedContext=e}async renderModel(e){return new Promise((t=>{P().render((0,E.jsx)(De,{value:this.sharedContext},(0,E.jsx)(Qt,{output:e.data[ze]})),this.node,t)}))}onBeforeDetach(){P().unmountComponentAtNode(this.node)}}class Yt{constructor(e){this.sharedContext=e}createNew(e,t){return e.content.rendermime.addFactory({createRenderer:()=>new Jt(this.sharedContext),defaultRank:0,mimeTypes:[ze],safe:!1}),new M.DisposableSet}}var Xt=s(12386),Gt=s(5531),es=s(89199);function ts(){return ts=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},ts.apply(this,arguments)}const ss="open-drillthrough",ns={Component:(0,m.r3w)((e=>{const{cube:t,onClick:s,selection:n,widgetState:o}=e,{formatMessage:i}=(0,$.useIntl)(),r=Oe(),a=Ue(),{mimeModel:l}=qe(),{widgetCreationCode:c}=l.data[Ke],u=(0,_.useMemo)((()=>{if((0,es.Yi)(n))return n.cells[0].tuple.filter((e=>"Measures"===e.dimensionName||!(0,Gt.Eu)((0,m._yD)(e,t),e)))}),[t,n]),h=(0,_.useMemo)((()=>{if(!u)return;const e=u.filter((e=>"Measures"!==e.dimensionName));return i({id:`aui.plugins.menu-item.${ss}.openDrillthrough`},{member:e.length>0?(0,Gt.eh)(e,{cube:t,hasOnlyCaptionForLeafLevels:!0,separator:", "}):void 0})}),[i,u,t]),g=(0,_.useCallback)((async e=>{if(s&&s(e),h&&u&&o.query.mdx){const e=(0,es.j6)({cube:t,sourceWidgetFilters:o.filters,tuple:u}),s={...m.oH_.initialState,filters:e,query:{...m.oH_.initialState.query,mdx:{elementType:"Drillthrough",select:{...o.query.mdx,axes:[],cellProps:void 0,slicerAxis:void 0}}},serverKey:d};yt({jupyterLab:r}),await at({code:c,notebookTracker:a,state:s})}}),[t,r,h,a,s,u,c,o]);return u&&o.query.mdx?(0,E.jsx)(Xt.Z.Item,ts({},(0,m.IWr)(e),{onClick:g}),(0,E.jsx)(m.Al8,{css:{marginRight:8}}),h):null})),key:ss,translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"}}};var os=s(51005),is=s(16318),rs=s(53740);function as(){return as=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},as.apply(this,arguments)}const{Text:ds}=rs.Z,ls={Component:e=>{const{formatMessage:t,locale:s,messages:n}=(0,$.useIntl)(),{activePivotClient:{url:o},contentClient:i,isQuerySession:r}=le(),{widgetName:a}=qe(),[d,c]=(0,_.useState)(!1),{widgetState:u}=e,h=(0,_.useCallback)((()=>{let e=!1;return(async()=>{if(!i)throw new Error("Missing content client on local sessions.");c(!0);const{name:r,widgetKey:d,...h}=(0,m.hNS)(u),g=()=>{e||c(!1)},p=[l];try{await i.createFile({content:h,metaData:{name:a??void 0,widgetKey:d},owners:p,pathToFolder:[],readers:p,type:"widget"});const e=V(o);is.default.success({description:(0,E.jsx)($.IntlProvider,{locale:s,messages:n},(0,E.jsx)($.FormattedMessage,{id:"aui.plugins.menu-item.publish-widget.successDescription",values:{a:t=>(0,E.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer"},t),b:e=>(0,E.jsx)(ds,{strong:!0},e),i:()=>(0,E.jsx)(m.Iwf,null)}})),getContainer:N,message:t({id:"aui.plugins.menu-item.publish-widget.successMessage"}),onClose:g})}catch(e){console.error(e),is.default.error({description:String(e),getContainer:N,message:t({id:"aui.plugins.menu-item.publish-widget.errorMessage"}),onClose:g})}})(),()=>{e=!0}}),[i,t,s,n,o,a,u]),g=(u.filters??[]).length>0,p=g||r||d;return(0,E.jsx)(os.default,as({},(0,m.IWr)(e),{disabled:p,title:g?t({id:"aui.plugins.menu-item.publish-widget.filteredWidgetsCannotBePublished"}):r?t({id:"aui.plugins.menu-item.publish-widget.querySessionWidgetsCannotBePublished"}):void 0,onClick:h}),(0,E.jsx)(_.Fragment,null,(0,E.jsx)(G.ShareAltOutlined,null),t({id:"aui.plugins.menu-item.publish-widget.publishWidgetInApp"})))},key:"publish-widget",translations:{"en-US":{errorMessage:"Widget could not be published",filteredWidgetsCannotBePublished:"Filtered widgets cannot be published",publishWidgetInApp:"Publish in app",querySessionWidgetsCannotBePublished:"Query session widgets cannot be published",successDescription:"Go to <a>the app</a>, create or open a dashboard, and click on the <b><i>icon</i> Widgets</b> icon in the <b>Left bar</b> to find your widget.",successMessage:"Widget published"}}},cs=e=>(0,Z.keyBy)(e,"key"),us=["undo","redo"];function hs(){return hs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},hs.apply(this,arguments)}const gs=({undoRedoKey:e,...t})=>{const{formatMessage:s}=(0,$.useIntl)(),n=Te();ne(n.changed,{property:"current",sender:n});const o=(0,_.useCallback)((()=>{"undo"===e?n.undo():n.redo()}),[e,n]),i="undo"===e?!n.canUndo:!n.canRedo;return(0,E.jsx)(os.default,hs({},(0,m.IWr)(t),{disabled:!n||i,title:i?s({id:`aui.plugins.menu-item.${e}.nothingToUndoRedo`}):void 0,onClick:o}),"undo"===e?(0,E.jsx)(G.UndoOutlined,null):(0,E.jsx)(G.RedoOutlined,null),s({id:`aui.plugins.menu-item.${e}.key`}))},ps=(e,{notebookTracker:t,widgetStateTrackers:s})=>n=>{const o=dt(t);return o?(0,E.jsx)(Me.Provider,{value:s},(0,E.jsx)(Pe,{cellMetadata:o.metadata},(0,E.jsx)(gs,hs({undoRedoKey:e},n)))):null},ms=[m.TA$,m.a2P,m._ll,m._dN,m.Uou,m.igv,m.W$X,m.$3o,m.GSY,m.Y8R,m.uVH,m.fO6,m.U_o,m.UiH,m.Y5x,m.EAR,m.M1w,m.Oj0,m.NWu,m.iph,m.wSQ,m.teE,m.C1v,m.oH_];m.oH_.cellStyle=m.iOR.key,m.oH_.contextMenuItems=[m._fi.key,m.A8w.key,m.Pmi.key,ls.key];const ys=ms.filter((({key:e})=>e.startsWith("plotly")));for(const e of ys)e.contextMenuItems=[...us,m.mPM.key,ns.key,m.Uk4.key,m.QYw.key,m.f$L.key,m.XWS.key,m.hkS.key,m.lJ3.key,ls.key];m.TA$.cell=m.gRB.key,m.TA$.cellStyle=m.OT2.key,m._ll.cell=m.ASS.key,m._ll.cellStyle=m.eyx.key,m.a2P.cell=m.BUk.key,m.a2P.cellStyle=m.OT2.key;const fs=[...us,m.mPM.key,ns.key,m.f$L.key,m.XWS.key,m.hkS.key,m.oCn.key,m.lJ3.key,ls.key];for(const e of[m.TA$,m.a2P])e.contextMenuItems=[m.Nn4.key,m.woi.key,...fs];m._ll.contextMenuItems=[m.WaG.key,m.yNZ.key,...fs],m._dN.contextMenuItems=[...us,m.mPM.key,ns.key,m.XWS.key,m.oCn.key,m.hkS.key,m.lJ3.key,ls.key];const ws={async activate(e,t,s,n,o,i){window.localStorage.getItem("_atotiEnableTestIds")===JSON.stringify(!0)&&(window.__UNSTABLE_DATA_TEST_IDS_ENABLED__=!0);const r=e,{docRegistry:l,shell:c}=r;console.debug(`Activating Atoti Python API extension 0.8.3 (relying on Atoti UI ${a.i8})`);const u=new _e({widgetPlugins:ms}),h=(({notebookTracker:e,widgetStateTrackers:t})=>us.map((s=>({Component:ps(s,{notebookTracker:e,widgetStateTrackers:t}),key:s,translations:{"en-US":{key:"undo"===s?"Undo":"Redo",nothingToUndoRedo:"Nothing to "+("undo"===s?"undo":"redo")}}}))))({notebookTracker:t,widgetStateTrackers:u}),g=(({undoRedoMenuItemPlugins:e,widgetPlugins:t})=>({cell:cs([m.gRB,m.ASS,m.BUk]),"cell-style":cs([m.iOR,m.OT2,m.eyx]),"menu-item":cs([m.XWS,m.Pmi,m.lJ3,m.mPM,ns,ls,m.f$L,m.hkS,m.oCn,m._fi,m.A8w,m.Uk4,m.QYw,m.Nn4,m.woi,m.WaG,m.yNZ,...e]),widget:cs(t)}))({undoRedoMenuItemPlugins:h,widgetPlugins:ms}),[p,y,f]=await Promise.all([v.create({pluginRegistry:g,settingRegistry:i}),Zt(),k.create(s)]),w=new ce,x={intlTracker:p,jupyterLab:r,jupyterServerProxyEnabled:y,notebookTracker:t,pluginRegistry:g,sessionClients:w,themeTracker:f,widgetStateTrackers:u},C=new Lt(x);c.add(C,"left",{rank:700}),o&&o.add(C,"atoti-sidebar"),l.addWidgetExtension("Notebook",new Bt(x)),l.addWidgetExtension("Notebook",new Yt(x)),(()=>{const e=document.createElement("div");e.id=m.pt,e.classList.add(A),document.body.append(e),D.default.config({getContainer:N})})(),(({commandPalette:e,intlTracker:t,jupyterLab:s,notebookTracker:n,sessionClients:o,widgetStateTrackers:i})=>{s.commands.addCommand(Ht,{async execute(){const{mdx:e,sessionId:t,widgetCreationCode:r}=Kt(n),a={...m.TA$.initialState,serverKey:d},l=await at({code:r,notebookTracker:n,state:a}),c=o.get(t);if(!c)throw new Error("The execution of the created cell should have created the corresponding SessionClient.");const u=i.get(l.model.metadata);if(!u)throw new Error("The execution of the created cell should have created the corresponding WidgetStateTracker.");const h=await(async e=>e.dataModel?e.dataModel:new Promise((t=>{const s=n=>{e.removeDataModelListener(s),t(n)};e.addDataModelListener(s)})))(c.activePivotClient),{widgetStateDerivedFromMdx:g}=(0,bt.jf)({dataModels:{[d]:h},mdx:(0,m.Qc3)(e),widgetPlugin:m.TA$,widgetState:a});u.setWidgetState(g),yt({jupyterLab:s})},isVisible:()=>void 0!==Kt(n),label:()=>(0,$.createIntl)(t.config).formatMessage({id:`commands.${Ft}.caption`})}),s.contextMenu.addItem({command:Ht,selector:zt}),s.contextMenu.addItem({selector:zt,type:"separator"}),e&&e.addItem({category:"Notebook Cell Operations",command:Ht})})({commandPalette:n,intlTracker:p,jupyterLab:r,notebookTracker:t,sessionClients:w,widgetStateTrackers:u})},autoStart:!0,id:"atoti",optional:[o.ICommandPalette,n.ILayoutRestorer,r.ISettingRegistry],requires:[i.INotebookTracker,o.IThemeManager]},xs=ws},6974:(e,t,s)=>{var n={"./en-US":[30736,736],"./en-US.js":[30736,736]};function o(e){if(!s.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],o=t[0];return s.e(t[1]).then((()=>s(o)))}o.keys=()=>Object.keys(n),o.id=6974,e.exports=o}}]);