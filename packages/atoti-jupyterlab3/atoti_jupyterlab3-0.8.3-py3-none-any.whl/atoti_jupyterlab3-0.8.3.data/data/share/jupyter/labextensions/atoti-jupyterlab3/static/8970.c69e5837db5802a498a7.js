"use strict";(self.webpackChunkatoti_jupyterlab3=self.webpackChunkatoti_jupyterlab3||[]).push([[8970],{98970:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var n=a(47078),o=a(56271),s=a(56953),i=a(79839),r=a(22765),l=a(74251),u=a(7739),d=a.n(u),c=a(24350),y=a.n(c),p=a(70894),x=a.n(p),m=a(7670),v=a(76059),C=a(62270),g=a(51024),f=a(64749),h=a(7974),b=a(65400),E=a(95782),k=a(89408),N=a(43010),w={name:"10bhair-QueryContextEntryTileCaption",styles:"display:flex;margin-right:16px;;label:QueryContextEntryTileCaption;"},Q={name:"1hmgl6r-QueryContextEntryTileCaption",styles:"flex-grow:1;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;;label:QueryContextEntryTileCaption;"},T={name:"whkwzk-QueryContextEntryTileCaption",styles:"text-align:right;flex-grow:1;flex-shrink:1;margin-left:10px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;min-width:35px;;label:QueryContextEntryTileCaption;"};const j=e=>{let t;const[a,s]=(0,o.useState)(null);if((0,o.useEffect)((()=>{"BOOL"!==e.type&&"ENUM"!==e.type&&s(e.value)}),[e.type,e.value]),"BOOL"===e.type)t=(0,n.jsx)(C.default,{checked:Boolean(e.value),disabled:e.isDisabled,onChange:()=>{var t;return null===(t=e.onValueChanged)||void 0===t?void 0:t.call(e,!e.value)}});else if(e.isDisabled)t=e.value;else if(e.type.startsWith("ENUM")){const a=(0,l.Vr)(e.type);t=(0,n.jsx)(f.Z,{value:e.value,size:"small",onChange:e.onValueChanged,disabled:e.isDisabled},a.map((e=>(0,n.jsx)(f.Z.Option,{key:e,value:e},e))))}else t=(0,n.jsx)(g.Z,{value:null!=a?a:"",onChange:e=>s(e.target.value),onBlur:t=>{const a=t.target.value;var n;isNaN(Number(a))&&"ALL"!==e.type||null===(n=e.onValueChanged)||void 0===n||n.call(e,a)},size:"small",disabled:e.isDisabled});return(0,n.jsx)("div",{css:w,key:e.name},(0,n.jsx)("div",{css:Q,title:e.name},e.name),(0,n.jsx)("div",{css:T},t))};var K={name:"1etlk4r-QueryContextEntryEditionPopup",styles:"height:35px;display:flex;justify-content:flex-end;margin-top:8px;;label:QueryContextEntryEditionPopup;"},S={name:"hpxvrh-QueryContextEntryEditionPopup",styles:"&.ant-btn{margin-right:8px;};label:QueryContextEntryEditionPopup;"};const q=e=>{var t;const{formatMessage:a}=(0,s.useIntl)(),{onOk:i,onCancel:r,templatedName:l}=e,[u,d]=(0,o.useState)(""),[c,y]=(0,o.useState)(""),p=(e=>{const t=e.indexOf("$"),a=e.lastIndexOf("$");return e.substring(t,a+1)})(l),x=l.replace(p,u);return(0,n.jsx)("div",{style:{width:400,display:"flex",flexDirection:"column"}},(0,n.jsx)("div",{style:{flexGrow:1}},(0,n.jsx)(g.Z,{style:{marginTop:8},placeholder:p,value:u,onChange:e=>d(e.target.value)}),(0,n.jsx)(g.Z,{style:{marginTop:8},placeholder:"value",value:c,onChange:e=>y(e.target.value)})),(0,n.jsx)("div",{css:K},(0,n.jsx)(b.default,{css:S,onClick:r},a({id:"aui.cancel"})),(0,n.jsx)(b.default,{onClick:()=>{i(x,c)},disabled:0===u.length||0===c.length||(null===(t=e.queryContext)||void 0===t?void 0:t.some((({key:e})=>e===x))),type:"primary"},a({id:"aui.ok"}))))},O=["drillthrough.hiddencolumns","subcube"],I=["mdx.kpi","mdx.member","mdx.formatters","mdx.set","mdx.measureAlias","mdx.defaultmembers","user-authentication"],V=["dashboard","page","widget"],R=(e,{sectionName:t,pageKey:a,leafKey:n})=>{const o="dashboard"===t?e:"page"===t?(0,E.fx)(e,a):(0,E.LI)(e,a,n);if(!o)throw new Error(`Impossible to edit the ${t}'s query context, as its corresponding state was not found.`);return o},D=(e,t,a)=>{e.queryContext||(e.queryContext=[]),e.queryContext.splice(a,0,t)},_=({dashboardState:e,pageKey:t,leafKey:a,userQueryContext:n,sectionName:o,queryContextEntry:s,position:i})=>{let r=n,l=e;return"user"===o?r=(0,h.produce)(n,(e=>{e.splice(i,0,s)})):l=(0,h.produce)(e,(e=>{const n=R(e,{sectionName:o,pageKey:t,leafKey:a});D(n,s,i)})),[l,r]},P=(e,t)=>{if(!e.queryContext)return;const{queryContext:a}=e;a.splice(t,1),0===a.length&&delete e.queryContext},Y=({dashboardState:e,pageKey:t,leafKey:a,userQueryContext:n,sectionName:o,position:s})=>{let i=n,r=e;return"user"===o?i=(0,h.produce)(n,(e=>{e.splice(s,1)})):r=(0,h.produce)(e,(e=>{const n=R(e,{sectionName:o,pageKey:t,leafKey:a});P(n,s)})),[r,i]},M=(0,i.r3)((e=>{const{dashboardState:t,pageKey:a,leafKey:u,onDashboardChange:c}=(0,v.F)(e)?e:{},{dataModel:p,widgetState:C,onWidgetChange:g}=e,{formatMessage:f}=(0,s.useIntl)(),[b]=(0,N.yu)("userQueryContext.isEnabled"),[E,,{isSet:w}]=(0,N.gI)("canUseUserQueryContext"),Q=(0,k.jC)(E,w,b);let T=V;Q&&(T=["user",...V]);const K=(0,i.cQ)(C,t,a),[,S]=(0,N.XP)("userQueryContext"),[M,U]=(0,o.useState)(null),A=(0,o.useMemo)((()=>y()(p.contextValues,"name")),[p.contextValues]),$=(0,o.useCallback)((e=>{if(A[e])return A[e].type;const t=x()(A,(({name:t})=>e.startsWith(t.replace(/\$.*\$$/,""))));return t?A[t].type:"ALL"}),[A]),L=(0,o.useMemo)((()=>{const e=p.contextValues.filter((({name:e})=>!O.some((t=>e.startsWith(t))))),t=d()(e,(({category:e})=>e||"misc"));return Object.keys(t).map((e=>({caption:e,isFolder:!0,isActionable:!1,type:e,children:t[e].map((t=>{const a={type:"QUERY_CONTEXT_ENTRY",key:t.name};return{caption:t.name,type:e,isActionable:!0,isDisabled:T.every((e=>{var a;return null===(a=K[e])||void 0===a?void 0:a.some((({key:e})=>e===t.name))})),dragItem:a}}))})))}),[p.contextValues,K,T]),W=(0,o.useMemo)((()=>{const o={};return o.default={placeholder:f({id:"aui.drawer.queryContextEditor.noQueryContextEntries"}),caption:f({id:"aui.drawer.queryContextEditor.defaultSection"}),tiles:e.cube.contextValues.filter((({name:e})=>I.every((t=>!e.startsWith(t)))&&O.every((t=>!e.startsWith(t))))).map((({name:e,value:t},a)=>{const o={key:e,value:t,originSection:"default",originPosition:a,type:"QUERY_CONTEXT_ENTRY"};return{caption:(0,n.jsx)(j,{name:e,value:t,isDisabled:!0,type:$(e)}),dragItem:o,isEditable:!1,isDisabled:T.some((t=>{var a;return null===(a=K[t])||void 0===a?void 0:a.some((({key:t})=>t===e))})),isRemovable:!1}}))},T.forEach((e=>{const s=K[e];o[e]={caption:f({id:`aui.drawer.queryContextEditor.${e}Section`}),tiles:s?s.map((({key:o,value:s},i)=>{const r={key:o,value:s,originSection:e,originPosition:i,type:"QUERY_CONTEXT_ENTRY"},l=T.slice(T.indexOf(e)+1).some((e=>{var t;return null===(t=K[e])||void 0===t?void 0:t.some((e=>o===e.key))}));return{caption:(0,n.jsx)(j,{name:o,value:s,type:$(o),isDisabled:l,onValueChanged:n=>{if(c&&t&&a&&u)if("user"===e){if(!K.user)return;const e=(0,h.produce)(K.user,(e=>{e[i].value=n}));S(e)}else{const o=(0,h.produce)(t,(t=>{R(t,{leafKey:u,pageKey:a,sectionName:e}).queryContext[i].value=n}));c(o)}else{const e=(0,h.produce)(C,(e=>{e.queryContext[i].value=n}));g(e)}}}),isEditable:!1,isRemovable:!0,isDisabled:l,dragItem:r}})):[]}})),M&&o[M.sectionName].tiles.splice(M.tileIndex,0,{caption:M.key,dragItem:null}),o}),[M,$,e.cube.contextValues,K,t,f,u,c,g,a,C,S,T]),X=(0,o.useCallback)(((e,n)=>{if(c&&t&&a&&u){const[o,s]=Y({dashboardState:t,pageKey:a,leafKey:u,userQueryContext:K.user||[],sectionName:e,position:n});o!==t&&c(o),s!==K.user&&S(s)}else{const e=(0,h.produce)(C,(e=>{P(e,n)}));g(e)}}),[t,u,c,a,K.user,C,g,S]),Z=(0,o.useCallback)(((n,o,s)=>{var i;const r=null!=s?s:(null===(i=K[n])||void 0===i?void 0:i.length)||0;if(-1!==o.indexOf("$"))U({tileIndex:r,sectionName:n,key:o});else{const s={key:o,value:(0,l.Q3)(A[o],e.cube.contextValues)};if(c&&t&&a&&u){const[e,o]=_({dashboardState:t,pageKey:a,leafKey:u,userQueryContext:K.user||[],sectionName:n,queryContextEntry:s,position:r});e!==t&&c(e),o!==K.user&&S(o)}else{const e=(0,h.produce)(C,(e=>{D(e,s,r)}));g(e)}}}),[A,t,u,c,g,a,K,C,e.cube.contextValues,S]),B=(0,o.useCallback)((e=>{var t;e.isActionable&&!(null===(t=K.widget)||void 0===t?void 0:t.some((({key:t})=>t===e.caption)))&&Z("widget",e.caption)}),[Z,K]),z=(0,o.useCallback)(((e,n)=>{if(M){const o={key:e,value:n};if(c&&t&&a&&u){const[e,n]=_({dashboardState:t,pageKey:a,leafKey:u,userQueryContext:K.user||[],sectionName:M.sectionName,queryContextEntry:o,position:M.tileIndex});e!==t&&c(e),n!==K.user&&S(n)}else{const e=(0,h.produce)(C,(e=>{D(e,o,M.tileIndex)}));g(e)}U(null)}}),[t,u,c,g,a,M,C,S,K.user]),F=(0,o.useCallback)(((e,n,o)=>{if(c&&t&&a&&u){var s;let i=t,r=null!==(s=K.user)&&void 0!==s?s:[];"default"!==n.originSection&&([i,r]=Y({dashboardState:t,pageKey:a,leafKey:u,userQueryContext:K.user||[],sectionName:n.originSection,position:n.originPosition})),"default"!==e&&([i,r]=_({dashboardState:i,pageKey:a,leafKey:u,userQueryContext:r||[],sectionName:e,position:o,queryContextEntry:{key:n.key,value:n.value}})),i!==t&&c(i),r!==K.user&&S(r)}}),[t,u,c,a,S,K.user]),G=(0,o.useCallback)(((e,t,a)=>{Z(e,t.key,a)}),[Z]);return(0,n.jsx)(i.A3,null,(0,n.jsx)(r.mp,{value:L,isSearchVisible:!0,searchPlaceholder:f({id:"aui.drawer.queryContextEditor.searchContextEntries"}),onClick:B}),(0,n.jsx)(m.e,{sections:W,dragItemTypes:["QUERY_CONTEXT_ENTRY"],canDrop:(e,t)=>{var a;return!("QUERY_CONTEXT_ENTRY"!==t.type||"default"===e||t.originSection&&t.originSection===e||(null===(a=K[e])||void 0===a?void 0:a.some((({key:e})=>e===t.key))))},placeholder:f({id:"aui.drawer.queryContextEditor.noQueryContextEntries"}),onTileRemoved:X,onTileMoved:F,onTileAdded:G,popoverPosition:M,popover:M&&(0,n.jsx)(q,{onOk:z,templatedName:M.key,onCancel:()=>U(null),queryContext:K[M.sectionName]}),popoverInnerHeight:110}))}))}}]);