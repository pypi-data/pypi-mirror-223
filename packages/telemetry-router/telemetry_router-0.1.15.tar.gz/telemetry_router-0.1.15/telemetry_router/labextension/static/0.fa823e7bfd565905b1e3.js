"use strict";(self.webpackChunktelemetry_router=self.webpackChunktelemetry_router||[]).push([[0],[(e,o,s)=>{s.r(o),s.d(o,{ITelemetryRouter:()=>h,TelemetryRouter:()=>v,default:()=>g});var t=s(930),n=s(151),r=s(255);async function i(e="",o={}){const s=r.ServerConnection.makeSettings(),t=n.URLExt.join(s.baseUrl,"telemetry-router",e);let i;try{i=await r.ServerConnection.makeRequest(t,o,s)}catch(e){throw new r.ServerConnection.NetworkError(e)}let c=await i.text();if(c.length>0)try{c=JSON.parse(c)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new r.ServerConnection.ResponseError(i,c.message||c);return c}class c{constructor(){v.registerConsumer(this)}consume(e){console.log("Base",e)}}class a extends c{constructor(){super()}consume(e){console.log("ConsoleLogger",e)}}class l extends c{constructor(){super()}async consume(e){const o={request:e,response:await i("mongo",{method:"POST",body:JSON.stringify(e)})};console.log("MongoDBLogger",o)}}class u extends c{constructor(){super()}async consume(e){const o={request:e,response:await i("s3",{method:"POST",body:JSON.stringify(e)})};console.log("S3Logger",o)}}const d="telemetry-router:plugin",h=new t.Token(d);class v{constructor(){this.sequence=0}static registerConsumer(e){v.registeredConsumers.push(e)}loadNotebookPanel(e){this.notebookPanel=e}async publishEvent(e){var o,s,t,n,r,c,a;this.sessionID===(null===(s=null===(o=this.notebookPanel)||void 0===o?void 0:o.sessionContext.session)||void 0===s?void 0:s.id)?this.sequence=this.sequence+1:(this.sessionID=null===(n=null===(t=this.notebookPanel)||void 0===t?void 0:t.sessionContext.session)||void 0===n?void 0:n.id,this.sequence=0);const{workspaceID:l}=await i("env"),u={event:e,notebookState:{workspaceID:l,sessionID:this.sessionID,sequence:this.sequence,notebookPath:null===(r=this.notebookPanel)||void 0===r?void 0:r.context.path,notebookContent:null===(a=null===(c=this.notebookPanel)||void 0===c?void 0:c.model)||void 0===a?void 0:a.toJSON()}};v.registeredConsumers.forEach((e=>{e.consume(u)}))}}v.registeredConsumers=[];const g={id:d,description:"A JupyterLab extension.",provides:h,autoStart:!0,activate:async e=>{const o=await i("version");console.log(`${d}: ${o}`);const s=new v;return new a,new l,new u,s}}}]]);